<%- include("./partials/head") %>

<body>
    <nav>
        <ul>
            <li><a href="/">Home</a></li>
        </ul>
    </nav>
    <div id="ny-guide-1">
        <h1 id="ny-guide">Ny Guide</h1>
        <div id="ny-guide-form">
            <form action="" method="POST" id="guide-form" enctype="multipart/form-data">
                <h3>Tittel</h3>
                <input type="text" name="tittel" id="" placeholder="Tittel" required autocomplete="off" class="guide-input">
                <h3>Tag</h3>
                <input type="text" name="tag" id="" placeholder="Tag separated by comma ( , )" required autocomplete="off" class="guide-input">
                <div id="addNewSection">
                    <div name="section">
                        <h2>Seksjon</h2>
                        <div>
                            <h3>Overskrift</h3>
                            <input type="text" name="overskrift[]" id="" placeholder="Overskrift" required autocomplete="off" class="guide-input">
                        </div>
                        <div>
                            <h3>Beskrivelse</h3>
                             <textarea name="beskrivelse[]" id="" placeholder="Beskrivelse" required autocomplete="off" class="guide-beskrivelse"></textarea>
                        </div>
                        <div id="drop-area">
                            <form class="my-form">
                              <p>Upload files by dragging & dropping, or select them</p>
                              <input type="file" id="fileElem" multiple accept="image/*" onchange="handleFiles(this.files)">
                              <label class="button" for="fileElem">Select some files</label>
                            </form>
                            <div id="gallery"></div>
                        </div>
                    </div>
                </div>
                </div>
                <div class="flex">
                    <button type="submit" id="new-guide-new" alt="Send Inn">
                        <i>S</i>
                        <i>E</i>
                        <i>N</i>
                        <i>D</i>
                        <i>&nbsp;</i>
                        <i>I</i>
                        <i>N</i>
                        <i>N</i>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div class="flex">
        <button onclick="lagNySeksjon()" id="ny-seksjon" alt="NY SEKSJON" id="border">
            <i>N</i>
            <i>Y</i>
            <i>&nbsp;</i>
            <i>S</i>
            <i>E</i>
            <i>K</i>
            <i>S</i>
            <i>J</i>
            <i>O</i>
            <i>N</i>
        </button>
    </div>

<script>
  // Drag and Drop functionality remains the same
  let dropArea = document.getElementById("drop-area");

// Prevent default behaviors
["dragenter", "dragover", "dragleave", "drop"].forEach(eventName => {
  dropArea.addEventListener(eventName, preventDefaults, false);
});

function preventDefaults(e) {
  e.preventDefault();
  e.stopPropagation();
}

// Highlight area when file is dragged over it
["dragenter", "dragover"].forEach(eventName => {
  dropArea.addEventListener(eventName, () => dropArea.classList.add("highlight"), false);
});

["dragleave", "drop"].forEach(eventName => {
  dropArea.addEventListener(eventName, () => dropArea.classList.remove("highlight"), false);
});

// Handle dropped files
dropArea.addEventListener("drop", handleDrop, false);

function handleDrop(e) {
  let dt = e.dataTransfer;
  let files = dt.files;

  handleFiles(files);
}

function handleFiles(files) {
  files = [...files];
  files.forEach(uploadFile);
  files.forEach(previewFile);
}

function previewFile(file) {
  let reader = new FileReader();
  reader.readAsDataURL(file);
  reader.onloadend = function () {
    let img = document.createElement("img");
    img.src = reader.result;
    img.classList.add("uploaded-image");
    document.getElementById("gallery").appendChild(img);
  };
}

function uploadFile(file) {
  let url = "/nyGuide"; // Your upload URL
  let formData = new FormData();
  formData.append("file", file);

  fetch(url, {
    method: "POST",
    body: formData,
  })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(() => console.error("Upload failed"));
}


function lagNySeksjon() {
    
    let newSection = document.getElementById("addNewSection");
    newSection.insertAdjacentHTML("beforeend",  
    `
    <div name="section">
                <h2>Seksjon</h2>
                <div>
                    <h3>Overskrift</h3>
                    <input type="text" name="overskrift[]" id="" placeholder="Overskrift" required autocomplete="off" class="guide-input">
                </div>
                <div>
                    <h3>Beskrivelse</h3>
                    <textarea name="beskrivelse[]" id="" placeholder="Beskrivelse" required autocomplete="off" class="guide-beskrivelse"></textarea>
                </div>
                    <div>
                        <h3>Bilde</h3>
                        <input type="file" name="bilde" accept="image/png image/jpg image/jpeg" class="flex" multiple id="uploadFile"/>                            
                    </div>
    `)
}
</script>

</body>